<?php get_header(); ?><?php function date_diff_report($date1, $date2) { 	$current = $date1; 	$datetime2 = date_create($date2); 	$count = 0; 	while(date_create($current) < $datetime2){ 		$current = gmdate("Y-m-d", strtotime("+1 day", strtotime($current))); 		$count++; 	} 	return $count; } function decimalHours($time){	$hms = explode(":", $time);	return ($hms[0] + ($hms[1]/60) + ($hms[2]/3600));}$table_name = $wpdb->prefix . "custom_timesheet";$table_name_project = $wpdb->prefix . "custom_project";$table_name_person = $wpdb->prefix . "custom_person";$timesheets = $wpdb->get_results("SELECT * FROM {$table_name}");$projects = $wpdb->get_results("SELECT * FROM {$table_name_project}");$project_names = $wpdb->get_results("SELECT DISTINCT project_name FROM {$table_name_project}");$persons = $wpdb->get_results("SELECT * FROM {$table_name_person}");?><div class="project_management_old">	<div class="display_main"><?php foreach($project_names as $project_name){	$total_client_hour = "";$person_hourly_rate_status = "";$start_date_status = "";$project_extra_expenses_status = "";$project_current_status_status = "";$project_description_status = "";$title_project = $project_name->project_name;?>				<div class="display_section">			<div class="header_titles">				<h2 class="display_title"><?php echo $title_project; ?></h2>			</div>			<div class="client_name_holder">				<div class="header_subtitle">					<h4 class="first_column">Client Name</h4>									<h4 class="second_column">Client Total Hour</h4>				</div>		<?php 			$client_names = $wpdb->get_results("SELECT * FROM {$table_name_project} WHERE project_name = '$project_name->project_name'");			foreach($client_names as $client_name){		?>								<?php					$test = $client_name->project_client;					$client_name_temp = "";					$total_hour_decimal = 0;					$get_last = "";					foreach ($timesheets as $key => $timesheet) {											if ($timesheet->task_label == $client_name->project_client) {							$get_last = $key;						}					}										foreach ($timesheets as $key => $timesheet){												if ($timesheet->task_label == $client_name->project_client){													// echo "<pre>";							// print_r($timesheet);							// echo "</pre>";							$task_hour = $timesheet->task_hour;								$task_person = $timesheet->task_person;							$decimal_hours = decimalHours($task_hour);							$rounded_hour = round($decimal_hours, 2);									$total_hour_decimal += $rounded_hour;							if($get_last == $key){								if($client_name->project_client != $client_name_temp){									$total_client_hour = $total_client_hour + $total_hour_decimal;									$client_name_temp = $client_name->project_client;									foreach($projects as $project){										if($project->project_client == $client_name_temp){											$project_responsible_worker = $project->project_responsible_worker;																						foreach($persons as $person){																								$person_full_name = $person->person_first_name ." ". $person->person_last_name;												if($person_full_name == $project_responsible_worker){													$project_extra_expenses 		= $project->project_extra_expenses;													$project_invoiced_amount 		= $project->project_invoiced_amount;																										$person_hourly_rate 			= $person->person_hourly_rate;													$total_expenses 				= ($total_client_hour * $person_hourly_rate) + $project_extra_expenses;													$profit_lost 					= ($total_expenses - $project_invoiced_amount);													$person_hourly_rate_status 		= ($person_hourly_rate != null) ? $person_hourly_rate : "";													$project_extra_expenses_status	= ($person_hourly_rate != null) ? $person_hourly_rate : "";																										$project_start_date 			= $project->project_start_date;													$project_estimated_deadline 	= $project->project_estimated_deadline;													$date_diff 						= date_diff_report($project_start_date,$project_estimated_deadline);																										$start_date_status 				= ($project_start_date != null) ? $project_start_date : "";													$project_current_status			= $project->project_current_status;													$project_current_status_status 	= ($project_current_status != null) ? $project_current_status : "";													$project_description			= $project->project_description;													$project_description_status 	= ($project_description != null) ? $project_description : "";												}											}										}									}				?>							<div class="display_list">								<div class="info_div">									<div class="first_column">										<h5 class="display_subtitle"><?php echo $client_name_temp; ?></h5>									</div>									<div class="second_column">										<h5><?php echo $total_hour_decimal; ?></h5>									</div>								</div>							</div>											<?php 											}							}						}					}					}									?>			</div>			<div class="project_detail">				<div class="info_div">					<h4 class="project_detail_column">Total Project hours</h4>					<h4 class="project_detail_column">Total expenses</h4>					<h4 class="project_detail_column">Profit/Loss</h4>					<h4 class="project_detail_column">Days in Production</h4>					<h4 class="project_detail_column">Current Status</h4>					<h4 class="project_detail_column">Description</h4>				</div>				<div class="info_div">					<h5 class="project_detail_column"><?php echo $total_client_hour; ?></h5>					<h5 class="project_detail_column">						<?php											if($person_hourly_rate_status != null && $project_extra_expenses_status != null){								echo $total_expenses;							}elseif($person_hourly_rate_status == null && $project_extra_expenses_status != null){								echo $total_client_hour + $project_extra_expenses_status;							}elseif($person_hourly_rate_status == null && $project_extra_expenses_status == null){								echo $total_client_hour;							}						?>					</h5>									<h5 class="project_detail_column">						<?php 							if($person_hourly_rate_status != null && $project_extra_expenses_status != null){								echo $profit_lost;							}elseif($person_hourly_rate_status == null && $project_extra_expenses_status == null){								echo $total_client_hour - $project_invoiced_amount;							}						?>					</h5>									<h5 class="project_detail_column"><?php echo ($start_date_status != null) ? $date_diff : ""; ?></h5>									<h5 class="project_detail_column"><?php echo ($project_current_status_status != null) ? $project_current_status: ""; ?></h5>									<h5 class="project_detail_column"><?php echo ($project_description_status != null) ? $project_description : ""; ?></h5>								</div>			</div>		</div>	<?php }	?>				</div></div><?php get_footer(); ?>