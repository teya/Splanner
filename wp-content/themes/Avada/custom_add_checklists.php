<?php /* Template name: Add Checklists */ ?><?php get_header(); ?><!-- ADD CHECKLIST ITEMS --><?php $table_name_checklist = $wpdb->prefix . "custom_checklist"; $table_name_checklist_category = $wpdb->prefix . "custom_checklist_category"; $table_name_checklist_template = $wpdb->prefix . "custom_checklist_template"; $template_checklists = $wpdb->get_results("SELECT * FROM {$table_name_checklist_template}");?><?php if(isset($_POST['submit_checklists'])){	$checklist_category = (isset($_POST['checklist_category']) ? $_POST['checklist_category'] : '');	$checklist_name_array = (isset($_POST['submit_checklist']) ? $_POST['submit_checklist'] : '');	$checklist_serialized = serialize($checklist_name_array);				global $wpdb;	$check_category = $wpdb->get_row("SELECT * FROM {$table_name_checklist_category} WHERE check_list_category = '$checklist_category'");		if($check_category == null){		$wpdb->insert( $table_name_checklist_category , array( 			'check_list_category'			=> $checklist_category,			'checklist_category_priority'	=> 0		), array( '%s', '%s' ));	}		$checklist_check_category = $wpdb->get_row("SELECT * FROM {$table_name_checklist} WHERE checklist_category = '$checklist_category'");		if($checklist_check_category == null){		$insert = $wpdb->insert( $table_name_checklist , array( 			'checklist_category'			=> $checklist_category,			'checklist'						=> $checklist_serialized,			'checklist_category_priority'	=> 0		), array( '%s', '%s' ));	}else{				$checklist_id = $checklist_check_category->ID;		$check_list = unserialize($checklist_check_category->checklist);		if($check_list != null){			if($checklist_name_array != null){				$merge_check_list = array_merge($check_list, $checklist_name_array);				$serialized_list = serialize($merge_check_list);							$insert = $wpdb->update( $table_name_checklist , array( 					'checklist'	=> $serialized_list					),					array( 'ID' => $checklist_id ),				array( '%s', '%s' ));			}else{				echo "<p class='message text_red'>No Checklist items to add</p>";			}		}else{			$insert = $wpdb->update( $table_name_checklist , array( 				'checklist'	=> $checklist_serialized			),				array( 'ID' => $checklist_id ),			array( '%s', '%s' ));		}	}			if($insert == 1){		echo "<p class='message'>";		echo "Checklist Added!";	}else{		echo "Checklist was not successfully added.";		echo "</p>";	}}?><!-- END ADD CHECKLIST ITEMS --><!-- ADD CHECKLIST TEMPLATE --><?php if(isset($_POST['submit_template'])){	$checklist_template = (isset($_POST['checklist_template']) ? $_POST['checklist_template'] : '');	$template_checklist_category = (isset($_POST['checklist']) ? $_POST['checklist'] : '');	 	$checklist_category_array = array();	if($template_checklist_category != null){		foreach($template_checklist_category as $checklist_category){						$checklist_category_explode = explode("<__>", $checklist_category);						$checklist_description_category_explode = explode('_', $checklist_category_explode[1]);			$checklist_name = stripslashes($checklist_category_explode[0]);			$checklist_description = $checklist_description_category_explode[0];			$checklist_category_priority = $checklist_description_category_explode[1];			$checklist_category_name = $checklist_description_category_explode[2];						$checklist_category_array[$checklist_category_priority ."_". $checklist_category_name][] = $checklist_name ."<__>". $checklist_description;					}		$serialized = serialize($checklist_category_array);		}			$check_template_checklist = $wpdb->get_row("SELECT * FROM {$table_name_checklist_template} WHERE checklist_template = '$checklist_template'");	$template_checklist_id = $check_template_checklist->ID;	if($check_template_checklist == null){		$insert = $wpdb->insert( $table_name_checklist_template , array( 			'checklist_template'	=> $checklist_template,			'checklist_items'		=> $serialized		), array( '%s', '%s' ));				if($insert == 1){			echo "<p class='message'>";			echo "Checklist Added!";		}else{			echo "Checklist was not successfully added.";			echo "</p>";		}	}else{		$update = $wpdb->update( $table_name_checklist_template , array( 			'checklist_items'	=> $serialized		),			array( 'ID' => $template_checklist_id ),		array( '%s', '%s' ));				if($update == 1){			echo "<p class='message'>";			echo "Checklist Updated!";		}else{			echo "Checklist was not successfully updated.";			echo "</p>";		}	}	}$checklist_templates = $wpdb->get_results("SELECT * FROM {$table_name_checklist_template}");$checklists = $wpdb->get_results("SELECT * FROM {$table_name_checklist} ORDER BY checklist_category_priority ASC");?><!-- END ADD CHECKLIST TEMPLATE --><!-- ADD CHECKLIST TEMPLATE --><div class="checklist_template_section two_third">	<h1>Add Items to Template</h1>	<form action="" method="post" name="check_list_template" id="check_list_template">		<div class="section">			<div class="left">				<p class="label">Checklist Template</p>			</div>			<div class="right">				<select name="checklist_template" class="checklist_template">					<?php foreach($checklist_templates as $key => $checklist_template){ ?>						<option><?php echo $checklist_template->checklist_template; ?></option>					<?php							if($key == 0){								$selected_template = $checklist_template->checklist_template;							}					?>					<?php } ?>				</select>				<div class="add_checklist_template button_2">Add Template</div>				<div style="display:none;" class="loader add_checklist_template_loader"></div>							</div>			<div style="display: none;" class="checklist_template_div">				<input type="text" name="add_checklist_template_input" class="add_checklist_template_input" />				<div class="add_template button_1">Add</div>				<div style="display:none;" class="add_template_loader loader"></div>				<p style="display: none;" class="text_red template_exist_note"></p>			</div>		</div>		<div class="border_separator"></div>		<div class="checklist">			<div class="columns">				<div class="column">					<?php 					$checked_template_checklists = $wpdb->get_results("SELECT * FROM {$table_name_checklist_template} WHERE checklist_template = '$selected_template'");					$checked_items_array = array();					foreach($checked_template_checklists as $template_checklist){												$unserialized = unserialize($template_checklist->checklist_items);						if($unserialized != null){							foreach($unserialized as $key => $checklist_items){								foreach($checklist_items as $checklist_item){									$checked_items_array[] = $checklist_item ."_". $key;								}														}						}					}						// print_var($checked_items_array);					?>					<div class="section">					<?php 						$i = 1;						foreach($checklists as $checklist) {							$checklist_category = $checklist->checklist_category;							$check_category = $wpdb->get_row("SELECT * FROM {$table_name_checklist_category} WHERE check_list_category = '$checklist_category'");															$check_category_id = $check_category->ID;					?>					<div class="check_group">						<div class="group_title"><h3><?php echo $checklist_category; ?></h3></div>						<div class="checkboxes">							<?php 								$checklist_category_priority = $checklist->checklist_category_priority;								$unserialized = unserialize($checklist->checklist);								if($unserialized != null){									foreach($unserialized as $key => $checklist_item){										$checklist_item_explode = explode('<__>', $checklist_item);																														$checklist_name = stripslashes($checklist_item_explode[0]);										$checklist_description = $checklist_item_explode[1];										$checklist_description_display = find_url($checklist_description);										$checklist_value = $checklist_name .'<__>'. $checklist_description .'_'. $checklist_category_priority .'_'. $checklist_category;								?>							<div id="checklist_item_display_<?php echo $check_category_id ."_". $key; ?>" class="checklist_item_display">								<input type="checkbox" <?php echo (in_array($checklist_value, $checked_items_array)) ? "checked" : ""; ?> name="checklist[]" class="template_checklist" value="<?php echo $checklist_value; ?>" />								<p class="checklist_label"><?php echo $checklist_name; ?></p>																<?php if($checklist_description != null){ ?>									<div id="checklist_item_display_<?php echo $check_category_id ."_". $key; ?>" class="has_description closed"></div>								<?php } ?>								<div style="display:none;" id="checklist_description_<?php echo $check_category_id ."_". $key; ?>" class="checklist_description_display">									<span class="span_bold"><?php echo $checklist_name; ?>: </span><?php echo $checklist_description_display; ?>								</div>							</div>														<?php 									} 								}							?>						</div>					</div>					<?php 						if($i % 3 == 0){							echo '</div><div class="section">';						} 						$i++;					?>					<?php } ?>					</div>									</div>			</div>		</div>		<input type="submit" name="submit_template" class="button_1 add_button" value="Save" />		<div class="button_2 clear_checkboxes">Clear</div>	</form></div><!-- END ADD CHECKLIST TEMPLATE --><!-- ADD CHECKLIST ITEMS --><?php $checklist_categories = $wpdb->get_results("SELECT * FROM {$table_name_checklist_category} ORDER BY checklist_category_priority ASC"); ?><div class="checklist category_add_checklist_section one_third last">	<h1>Add/Edit Categories & Items</h1>	<form action="" method="post" name="check_list" id="check_list">		<div class="section">			<div class="left">				<p class="label">Category</p>			</div>			<div class="right">				<select class="checklist_category" name="checklist_category">					<?php foreach($checklist_categories as $key => $checklist_category){ ?>						<option><?php echo $checklist_category->check_list_category; ?></option>						<?php						if($key == 0){							$selected_category = $checklist_category->check_list_category;							$selected_category_id = $checklist_category->ID;						}						?>					<?php } ?>				</select>				<div class="add_checklist_category button_2">Add Category</div>				<div style="display: none;" class="checklist_select_loader loader"></div>			</div>			<div style="display: none;" class="checklist_category_div">				<input type="text" name="add_checklist_category_input" class="add_checklist_category_input" />				<div class="add_category button_1">Add</div>					</div>		</div>		<div class="section checklist_items_section">			<div class="left">				<p class="list_name_header label">Item</p>				<p class="list_description_header label">Description</p>			</div>		</div>		<div class="section checklist_items_section">						<div class="category_checklist_items">				<ul class="checklist_category_items">				<?php 					$checklist_category_items = $wpdb->get_row("SELECT * FROM {$table_name_checklist} WHERE checklist_category = '$selected_category'");					$category_items = unserialize($checklist_category_items->checklist);					if($category_items != null){						foreach($category_items as $key => $category_item){							$checklist_name_description = stripslashes($category_item);						$checklist_name_description_explode = explode('<__>', $checklist_name_description);						$checklist_name = $checklist_name_description_explode[0];						$checklist_description = $checklist_name_description_explode[1];						$checklist_description_display = find_url($checklist_description);				?>										<li id="checklist_display_<?php echo $selected_category_id .'_'. $key; ?>">							<div class="section">								<div class="left">									<p id="name_item_p_<?php echo $key ?>" class="checklist_name_display"><?php echo $checklist_name; ?></p>									<input type="text" style="display:none" id="checklist_name_input_<?php echo $key; ?>" value="<?php echo $checklist_name; ?>" />									<p id="description_item_p_<?php echo $key ?>" class="checklist_description_display"><?php echo $checklist_description_display; ?></p>									<textarea style="display:none" name="checklist_description" id="checklist_description_input_<?php echo $key; ?>"><?php echo $checklist_description; ?></textarea>												</div>								<div class="action_buttons right">																		<div style="display:none" id="check_item_<?php echo $key; ?>" class="check_button"></div>									<div id="checklist_delete_<?php echo $selected_category_id .'_'. $key; ?>" class="delete_item_<?php echo $key;  ?> checklist_delete button_2 checklist_action_button">D</div>									<div id="edit_item_<?php echo $key; ?>" class="button_2 checklist_action_button edit_checklist_item">E</div>									<div style="display:none" id="check_item_loader_<?php echo $key; ?>" class="loader"></div>								</div>							</div>						</li>				<?php 							} 					}				?>				</ul>			</div>				</div>		<div class="border_separator"></div>		<div class="add_checklist_item">			<h3>Add Checklist Item</h3>			<div class="checklist_container"></div>			<div class="add_checklist_item_form">				<div class="section">									<div class="left">						<p class="label">Name</p>					</div>								<div class="right">						<input type="text" class="checklist_name" name="checklist_name" />									</div>				</div>				<div class="section">									<div class="left">						<p class="label">Description</p>					</div>								<div class="right">						<textarea name="checklist_description" class="checklist_description"></textarea>						<div class="button_2 add_more_list">Add</div>					</div>				</div>			</div>		</div>		<input type="submit" name="submit_checklists" class="button_1 add_button" value="Save" />			</form>	</div><form method="post" id="edit_modal_checklist" class="add_checklist_edit_form">	<input type="hidden" name="checklist_name" class="checklist_name" />	<input type="hidden" name="checklist_description" class="checklist_description" name="checklist_description" />	<input type="hidden" name="checklist_key" class="checklist_key" />	<input type="hidden" name="checklist_category" class="checklist_category" value="<?php echo $selected_category ?>" />	<input type="hidden" name="checklist_category_id" class="checklist_category_id" value="<?php echo $selected_category_id ?>" />		</form><div style="display:none;" id="dialog_form_delete_checklist" title="Delete Checklist"></div><!-- END ADD CHECKLIST ITEMS --><?php get_footer(); ?>