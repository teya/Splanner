<?php /* Template Name: Staff Timesheet */ ?><?php get_header(); ?><?php $week_number = date('W'); ?><script>jQuery(document).ready(function(){		jQuery('#week_number').val('<?php echo $week_number; ?>');	jQuery('#week_number_calendar').datepicker({		dateFormat: 'yy-mm-dd',		showWeek: true,		firstDay: 1,		markerClassName: 'hasDatepicker',		onSelect: function (dateText, inst) {			var weekNum = jQuery.datepicker.iso8601Week(new Date(dateText));				jQuery('#week_number').val(weekNum);					}		});		});</script><script>	jQuery(document).ready(function(){		jQuery('#prev').click(function(e){					var current_tab = jQuery('.tabs_li.active a').text();				var current_number = 1;				switch(current_tab){			case "Monday":				current_number = 1;			break;			case "Tuesday":				current_number = 1;			break;			case "Wednesday":				current_number = 2;			break;			case "Thursday":				current_number = 3;			break;			case "Friday":				current_number = 4;			break;			case "Saturday":				current_number = 5;			break;			case "Sunday":				current_number = 6;			break;					}						jQuery('.tabs-container .tab_content').hide();			jQuery('.tabs_li').removeClass("active");			jQuery('.tabs_li:nth-child('+current_number+')').addClass("active");			jQuery('.tab-box div:nth-child('+current_number+')').show();					});		jQuery('#next').click(function(e){						var current_tab = jQuery('.tabs_li.active a').text();						var current_number = 1;			switch(current_tab){				case "Monday":				current_number = 2;				break;				case "Tuesday":				current_number = 3;				break;				case "Wednesday":				current_number = 4;				break;				case "Thursday":				current_number = 5;				break;				case "Friday":				current_number = 6;				break;				case "Saturday":				current_number = 7;				break;				case "Sunday":				current_number = 7;				break;							}						jQuery('.tabs-container .tab_content').hide();			jQuery('.tabs_li').removeClass("active");			jQuery('.tabs_li:nth-child('+current_number+')').addClass("active");						jQuery('.tab-box div:nth-child('+current_number+')').show();					});	});</script><?php global $wpdb;$table_name = $wpdb->prefix . "custom_person";$table_name_timesheet = $wpdb->prefix . "custom_timesheet";$persons = $wpdb->get_results("SELECT * FROM {$table_name}");?><?php$current_user = wp_get_current_user();$current_user_name = $current_user->data->display_name;$current_user_role = $current_user->roles['0'];if($current_user_role == 'administrator' || $current_user_role == 'editor'){?><div class="staff_timesheet">	<div class="left_div">		<form class="staff_timesheet_form">			<div class="choose_person">				<p class="label">Person Name: </p>				<select name="person_name" class="person_name">		<?php 				foreach($persons as $person){ 					$person_name = $person->person_first_name ." ". $person->person_last_name;		?>							<option><?php echo $person_name; ?></option>				<?php } ?>				</select>			</div>			<div id="week_number_calendar">						<input type="hidden" value="" name="week_number" class="week_number" id="week_number"/>								</div>		</form>		<div class="button_1 staff_timesheet_search">Search</div>	</div>	<div class="right_div">		<div class="top_nav">			<div class="week_section">			<?php 				$week_number_range = date('W');				$year = date('Y');				$week = getStartAndEndDate($week_number_range, $year);				$start_num = $week[0];				$end_num = $week[1];				$start = date("d M Y", strtotime($start_num));				$end = date("d M Y", strtotime($end_num));			?>				<h3 class="week">Week: <?php echo $start .' '.'-'.' '. $end?></h3>			</div>						<div class="navigation_button">				<div style="display: none" class="top_loader loader"></div>				<button id="prev" class="button_1">Prev</button>				<button id="next" class="button_1">Next</button>			</div>		</div>		<div class="header_person_name"><h3>Your Timesheet</h3></div>		<div class="tab-holder">			<div class="tab-hold tabs-wrapper">				<div class="full_width">									<ul id="tabs" class="tabset tabs">						<li class="tabs_li active <?php echo ($day_now == 'Monday') ? 'active' : ''; ?>"><a href="#monday">Monday</a></li>											<li class="tabs_li <?php echo ($day_now == 'Tuesday') ? 'active' : ''; ?>"><a href="#tuesday">Tuesday</a></li>											<li class="tabs_li <?php echo ($day_now == 'Wednesday') ? 'active' : ''; ?>"><a href="#wednesday">Wednesday</a></li>											<li class="tabs_li <?php echo ($day_now == 'Thursday') ? 'active' : ''; ?>"><a href="#thursday">Thursday</a></li>											<li class="tabs_li <?php echo ($day_now == 'Friday') ? 'active' : ''; ?>"><a href="#friday">Friday</a></li>											<li class="tabs_li <?php echo ($day_now == 'Saturday') ? 'active' : ''; ?>"><a href="#saturday">Saturday</a></li>											<li class="tabs_li <?php echo ($day_now == 'Sunday') ? 'active' : ''; ?>"><a href="#sunday">Sunday</a></li>					</ul>				</div>				<div class="tab-box tabs-container">					<!------------------------------------------------------ MONDAY ------------------------------------------------------->										<div id="monday" class="tab tab_content active" style="display: block;">						<div class="person_task">							<div class="header_titles">								<div class="first_column">									<h3>Client</h3>								</div>								<div class="second_column">									<h3>Task Name</h3>								</div>								<div class="third_column">									<h3>Project Name</h3>								</div>								<div class="fourth_column">									<h3>Hour</h3>								</div>								<div class="fifth_column">									<h3>Description</h3>								</div>							</div>						<?php 							$person_tasks = $wpdb->get_results("SELECT * FROM $table_name_timesheet WHERE task_person = '$current_user_name' AND week_number = '$week_number' AND day_now = 'Monday'");							$total_hour_decimal = 0;							foreach($person_tasks as $person_task){								$client_name 			= $person_task->task_label;								$task_name 				= $person_task->task_name ." - ". $person_task->task_suffix;								$task_project_name 		= $person_task->task_project_name;								$task_hour 				= $person_task->task_hour;								$task_hour_decimal 		= decimalHours($task_hour);								$total_hour_decimal		+= $task_hour_decimal;								$task_description	 	= $person_task->task_description;								if($task_description != null){									$description_title = substr($task_description, 0, 45) . "...";																	}else{									$description_title = "&nbsp;";								}						?>							<div class="info_div">								<div class="first_column"><li><?php echo $client_name; ?></li></div>								<div class="second_column"><li><?php echo $task_name; ?></li></div>								<div class="third_column"><li><?php echo $task_project_name; ?></li></div>								<div class="fourth_column"><li><?php echo $task_hour; ?></li></div>								<div class="fifth_column">									<li>																			<div class="accordian">											<h5 class="toggle">												<a href="#"><li><?php echo $description_title ; ?><span class="arrow"></span></li></a>											</h5>											<div class="toggle-content" style="display: none;">												<?php echo $task_description; ?>											</div>										</div>									</li>								</div>							</div>												<?php }	?>						<?php $total_hour =  gmdate('H:i:s', floor($total_hour_decimal * 3600)); ?>							<div class="total_hours">								<div class="task_total"><h3>TOTAL</h3></div>								<div class="task_total_hour"><h3><?php echo $total_hour; ?></h3></div>							</div>							</div>					</div>					<!------------------------------------------------------ TUESDAY ------------------------------------------------------->					<div id="tuesday" class="tab tab_content" style="display: none;">						<div class="person_task">							<div class="header_titles">								<div class="first_column">									<h3>Client</h3>								</div>								<div class="second_column">									<h3>Task Name</h3>								</div>								<div class="third_column">									<h3>Project Name</h3>								</div>								<div class="fourth_column">									<h3>Hour</h3>								</div>								<div class="fifth_column">									<h3>Description</h3>								</div>							</div>							<?php 								$person_tasks = $wpdb->get_results("SELECT * FROM $table_name_timesheet WHERE task_person = '$current_user_name' AND week_number = '$week_number' AND day_now = 'Tuesday'");								$total_hour_decimal = 0;								foreach($person_tasks as $person_task){									$client_name 			= $person_task->task_label;									$task_name 				= $person_task->task_name ." - ". $person_task->task_suffix;									$task_project_name 		= $person_task->task_project_name;									$task_hour 				= $person_task->task_hour;									$task_hour_decimal 		= decimalHours($task_hour);									$total_hour_decimal		+= $task_hour_decimal;									$task_description	 	= $person_task->task_description;									if($task_description != null){										$description_title = substr($task_description, 0, 45) . "...";																			}else{										$description_title = "&nbsp;";									}								?>								<div class="info_div">									<div class="first_column"><li><?php echo $client_name; ?></li></div>									<div class="second_column"><li><?php echo $task_name; ?></li></div>									<div class="third_column"><li><?php echo $task_project_name; ?></li></div>									<div class="fourth_column"><li><?php echo $task_hour; ?></li></div>									<div class="fifth_column"><li>																			<div class="accordian">											<h5 class="toggle">												<a href="#"><li><?php echo $description_title ; ?><span class="arrow"></span></li></a>											</h5>											<div class="toggle-content" style="display: none;">												<?php echo $task_description; ?>											</div>										</div>									</li></div>								</div>													<?php }	?>							<?php $total_hour =  gmdate('H:i:s', floor($total_hour_decimal * 3600)); ?>							<div class="total_hours">								<div class="task_total"><h3>TOTAL</h3></div>								<div class="task_total_hour"><h3><?php echo $total_hour; ?></h3></div>							</div>							</div>					</div>					<!------------------------------------------------------ WEDNESDAY ------------------------------------------------------->					<div id="wednesday" class="tab tab_content" style="display: none;">						<div class="person_task">							<div class="header_titles">								<div class="first_column">									<h3>Client</h3>								</div>								<div class="second_column">									<h3>Task Name</h3>								</div>								<div class="third_column">									<h3>Project Name</h3>								</div>								<div class="fourth_column">									<h3>Hour</h3>								</div>								<div class="fifth_column">									<h3>Description</h3>								</div>							</div>							<?php 								$person_tasks = $wpdb->get_results("SELECT * FROM $table_name_timesheet WHERE task_person = '$current_user_name' AND week_number = '$week_number' AND day_now = 'Wednesday'");								$total_hour_decimal = 0;								foreach($person_tasks as $person_task){									$client_name 			= $person_task->task_label;									$task_name 				= $person_task->task_name ." - ". $person_task->task_suffix;									$task_project_name 		= $person_task->task_project_name;									$task_hour 				= $person_task->task_hour;									$task_hour_decimal 		= decimalHours($task_hour);									$total_hour_decimal		+= $task_hour_decimal;									$task_description	 	= $person_task->task_description;									if($task_description != null){										$description_title = substr($task_description, 0, 45) . "...";																			}else{										$description_title = "&nbsp;";									}								?>								<div class="info_div">									<div class="first_column"><li><?php echo $client_name; ?></li></div>									<div class="second_column"><li><?php echo $task_name; ?></li></div>									<div class="third_column"><li><?php echo $task_project_name; ?></li></div>									<div class="fourth_column"><li><?php echo $task_hour; ?></li></div>									<div class="fifth_column"><li>																			<div class="accordian">											<h5 class="toggle">												<a href="#"><li><?php echo $description_title ; ?><span class="arrow"></span></li></a>											</h5>											<div class="toggle-content" style="display: none;">												<?php echo $task_description; ?>											</div>										</div>									</li></div>								</div>													<?php }	?>							<?php $total_hour =  gmdate('H:i:s', floor($total_hour_decimal * 3600)); ?>							<div class="total_hours">								<div class="task_total"><h3>TOTAL</h3></div>								<div class="task_total_hour"><h3><?php echo $total_hour; ?></h3></div>							</div>							</div>					</div>					<!------------------------------------------------------ THURSDAY ------------------------------------------------------->					<div id="thursday" class="tab tab_content" style="display: none;">						<div class="person_task">							<div class="header_titles">								<div class="first_column">									<h3>Client</h3>								</div>								<div class="second_column">									<h3>Task Name</h3>								</div>								<div class="third_column">									<h3>Project Name</h3>								</div>								<div class="fourth_column">									<h3>Hour</h3>								</div>								<div class="fifth_column">									<h3>Description</h3>								</div>							</div>							<?php 								$person_tasks = $wpdb->get_results("SELECT * FROM $table_name_timesheet WHERE task_person = '$current_user_name' AND week_number = '$week_number' AND day_now = 'Thursday'");								$total_hour_decimal = 0;								foreach($person_tasks as $person_task){									$client_name 			= $person_task->task_label;									$task_name 				= $person_task->task_name ." - ". $person_task->task_suffix;									$task_project_name 		= $person_task->task_project_name;									$task_hour 				= $person_task->task_hour;									$task_hour_decimal 		= decimalHours($task_hour);									$total_hour_decimal		+= $task_hour_decimal;									$task_description	 	= $person_task->task_description;									if($task_description != null){										$description_title = substr($task_description, 0, 45) . "...";																			}else{										$description_title = "&nbsp;";									}								?>								<div class="info_div">									<div class="first_column"><li><?php echo $client_name; ?></li></div>									<div class="second_column"><li><?php echo $task_name; ?></li></div>									<div class="third_column"><li><?php echo $task_project_name; ?></li></div>									<div class="fourth_column"><li><?php echo $task_hour; ?></li></div>									<div class="fifth_column"><li>																			<div class="accordian">											<h5 class="toggle">												<a href="#"><li><?php echo $description_title ; ?><span class="arrow"></span></li></a>											</h5>											<div class="toggle-content" style="display: none;">												<?php echo $task_description; ?>											</div>										</div>									</li></div>								</div>													<?php }	?>							<?php $total_hour =  gmdate('H:i:s', floor($total_hour_decimal * 3600)); ?>							<div class="total_hours">								<div class="task_total"><h3>TOTAL</h3></div>								<div class="task_total_hour"><h3><?php echo $total_hour; ?></h3></div>							</div>							</div>					</div>					<!------------------------------------------------------ FRIDAY ------------------------------------------------------->					<div id="friday" class="tab tab_content" style="display: none;">						<div class="person_task">							<div class="header_titles">								<div class="first_column">									<h3>Client</h3>								</div>								<div class="second_column">									<h3>Task Name</h3>								</div>								<div class="third_column">									<h3>Project Name</h3>								</div>								<div class="fourth_column">									<h3>Hour</h3>								</div>								<div class="fifth_column">									<h3>Description</h3>								</div>							</div>							<?php 								$person_tasks = $wpdb->get_results("SELECT * FROM $table_name_timesheet WHERE task_person = '$current_user_name' AND week_number = '$week_number' AND day_now = 'Friday'");								$total_hour_decimal = 0;								foreach($person_tasks as $person_task){									$client_name 			= $person_task->task_label;									$task_name 				= $person_task->task_name ." - ". $person_task->task_suffix;									$task_project_name 		= $person_task->task_project_name;									$task_hour 				= $person_task->task_hour;									$task_hour_decimal 		= decimalHours($task_hour);									$total_hour_decimal		+= $task_hour_decimal;									$task_description	 	= $person_task->task_description;									if($task_description != null){										$description_title = substr($task_description, 0, 45) . "...";																			}else{										$description_title = "&nbsp;";									}								?>								<div class="info_div">									<div class="first_column"><li><?php echo $client_name; ?></li></div>									<div class="second_column"><li><?php echo $task_name; ?></li></div>									<div class="third_column"><li><?php echo $task_project_name; ?></li></div>									<div class="fourth_column"><li><?php echo $task_hour; ?></li></div>									<div class="fifth_column"><li>																			<div class="accordian">											<h5 class="toggle">												<a href="#"><li><?php echo $description_title ; ?><span class="arrow"></span></li></a>											</h5>											<div class="toggle-content" style="display: none;">												<?php echo $task_description; ?>											</div>										</div>									</li></div>								</div>													<?php }	?>							<?php $total_hour =  gmdate('H:i:s', floor($total_hour_decimal * 3600)); ?>							<div class="total_hours">								<div class="task_total"><h3>TOTAL</h3></div>								<div class="task_total_hour"><h3><?php echo $total_hour; ?></h3></div>							</div>							</div>					</div>					<!------------------------------------------------------ SATURDAY ------------------------------------------------------->					<div id="saturday" class="tab tab_content" style="display: none;">						<div class="person_task">							<div class="header_titles">								<div class="first_column">									<h3>Client</h3>								</div>								<div class="second_column">									<h3>Task Name</h3>								</div>								<div class="third_column">									<h3>Project Name</h3>								</div>								<div class="fourth_column">									<h3>Hour</h3>								</div>								<div class="fifth_column">									<h3>Description</h3>								</div>							</div>							<?php 								$person_tasks = $wpdb->get_results("SELECT * FROM $table_name_timesheet WHERE task_person = '$current_user_name' AND week_number = '$week_number' AND day_now = 'Saturday'");								$total_hour_decimal = 0;								foreach($person_tasks as $person_task){									$client_name 			= $person_task->task_label;									$task_name 				= $person_task->task_name ." - ". $person_task->task_suffix;									$task_project_name 		= $person_task->task_project_name;									$task_hour 				= $person_task->task_hour;									$task_hour_decimal 		= decimalHours($task_hour);									$total_hour_decimal		+= $task_hour_decimal;									$task_description	 	= $person_task->task_description;									if($task_description != null){										$description_title = substr($task_description, 0, 45) . "...";																			}else{										$description_title = "&nbsp;";									}								?>								<div class="info_div">									<div class="first_column"><li><?php echo $client_name; ?></li></div>									<div class="second_column"><li><?php echo $task_name; ?></li></div>									<div class="third_column"><li><?php echo $task_project_name; ?></li></div>									<div class="fourth_column"><li><?php echo $task_hour; ?></li></div>									<div class="fifth_column"><li>																			<div class="accordian">											<h5 class="toggle">												<a href="#"><li><?php echo $description_title ; ?><span class="arrow"></span></li></a>											</h5>											<div class="toggle-content" style="display: none;">												<?php echo $task_description; ?>											</div>										</div>									</li></div>								</div>													<?php }	?>							<?php $total_hour =  gmdate('H:i:s', floor($total_hour_decimal * 3600)); ?>							<div class="total_hours">								<div class="task_total"><h3>TOTAL</h3></div>								<div class="task_total_hour"><h3><?php echo $total_hour; ?></h3></div>							</div>							</div>					</div>					<!------------------------------------------------------ SUNDAY ------------------------------------------------------->					<div id="sunday" class="tab tab_content" style="display: none;">						<div class="person_task">							<div class="header_titles">								<div class="first_column">									<h3>Client</h3>								</div>								<div class="second_column">									<h3>Task Name</h3>								</div>								<div class="third_column">									<h3>Project Name</h3>								</div>								<div class="fourth_column">									<h3>Hour</h3>								</div>								<div class="fifth_column">									<h3>Description</h3>								</div>							</div>							<?php 								$person_tasks = $wpdb->get_results("SELECT * FROM $table_name_timesheet WHERE task_person = '$current_user_name' AND week_number = '$week_number' AND day_now = 'Sunday'");																$total_hour_decimal = 0;								foreach($person_tasks as $person_task){									$client_name 			= $person_task->task_label;									$task_name 				= $person_task->task_name ." - ". $person_task->task_suffix;									$task_project_name 		= $person_task->task_project_name;									$task_hour 				= $person_task->task_hour;									$task_hour_decimal 		= decimalHours($task_hour);									$total_hour_decimal		+= $task_hour_decimal;									$task_description	 	= $person_task->task_description;									if($task_description != null){										$description_title = substr($task_description, 0, 45) . "...";																			}else{										$description_title = "&nbsp;";									}								?>								<div class="info_div">									<div class="first_column"><li><?php echo $client_name; ?></li></div>									<div class="second_column"><li><?php echo $task_name; ?></li></div>									<div class="third_column"><li><?php echo $task_project_name; ?></li></div>									<div class="fourth_column"><li><?php echo $task_hour; ?></li></div>									<div class="fifth_column"><li>																			<div class="accordian">											<h5 class="toggle">												<a href="#"><li><?php echo $description_title ; ?><span class="arrow"></span></li></a>											</h5>											<div class="toggle-content" style="display: none;">												<?php echo $task_description; ?>											</div>										</div>									</li></div>								</div>													<?php }	?>							<?php $total_hour =  gmdate('H:i:s', floor($total_hour_decimal * 3600)); ?>							<div class="total_hours">								<div class="task_total"><h3>TOTAL</h3></div>								<div class="task_total_hour"><h3><?php echo $total_hour; ?></h3></div>							</div>							</div>					</div>				</div>			</div>		</div>	</div></div><?php }else{	echo "You don't have sufficient permission to access this page";} ?><?php get_footer(); ?>